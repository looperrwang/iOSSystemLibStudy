#  About Color-Renderable Pixel Format Sizes

> Know the size limits of pixel formats used by color render targets in iOS and tvOS GPUs.

了解 iOS 和 tvOS GPU 中颜色渲染目标使用的像素格式的大小限制。

## Overview

> A color render target is a texture used as an output destination for color data generated by a render pass. Pixel formats that can be assigned to these color render targets are known as color-renderable pixel formats.
>
> The storage size of each pixel format is determined by the sum of its components. For example, the storage size of BGRA8Unorm is 32 bits per pixel (four 8-bit components), and the storage size of BGR5A1Unorm is 16 bits per pixel (three 5-bit components and one 1-bit component). When multiple render targets are used in a single render pass, the combined storage size for that render pass is equal to the combined size of the pixel formats used by the render targets in that pass.
>
> In iOS and tvOS GPUs, the storage size of color render targets is interpreted differently in tile memory than it is in system memory, according to the color-renderable pixel format that you assign to the target. Because tile memory has a limited size, the combined size of all color render targets in an individual render pass must fit within the tile memory size limit, as shown in Table 1.
>
> Table 1 Maximum number and size of color render targets for each iOS and tvOS GPU

颜色渲染目标是用作渲染过程生成的颜色数据的输出目标的纹理。可以分配给这些颜色渲染目标的像素格式称为 color-renderable 像素格式。

每个像素格式的存储大小由其组件的总和确定。例如，BGRA8Unorm 的存储大小为每像素 32 位（四个 8 位分量），BGR5A1Unorm 的存储大小为每像素 16 位（三个 5 位分量和一个 1 位分量）。在单个渲染过程中使用多个渲染目标时，该渲染过程的组合存储大小等于该过程中渲染目标使用的像素格式的组合大小。

在 iOS 和 tvOS GPU 中，根据分配给目标的 color-renderable 像素格式，颜色渲染目标的存储大小在 tile 内存中的解释与在系统内存中的解释不同。由于 tile 内存的大小有限，因此单个渲染过程中所有颜色渲染目标的组合大小必须符合 tile 内存大小限制，如表 1 所示。

表格 1 iOS 和 tvOS GPU 的渲染目标的最大数量和大小

iOS/tvOS GPU | Maximum number of color render targets | Maximum combined size of color render targets
:------------: | :-------------: | :-------------:
A7 | Four per render pass | 128 bits per pixel
A8, A9, A10 | Eight per render pass | 256 bits per pixel
A11 | Eight per render pass | 512 bits per pixel

> In macOS GPUs, you can use up to eight color render targets per render pass with any color-renderable pixel format. Because macOS GPUs don't have tile memory, they don't have a combined size limit for their color render targets.

在 macOS GPU 中，每个渲染过程最多可以使用八个颜色渲染目标和任何 color-renderable 像素格式。由于 macOS GPU 没有 tile 内存，因此它们的颜色渲染目标没有组合大小限制。

## Pixel Format Size Conversion in Tile Memory

> In A7 through A10 GPUs, some color-renderable pixel formats are temporarily expanded to a floating-point representation when stored in tile memory. Therefore, these pixel formats occupy more space in tile memory than they do in system memory, as shown in Table 2 and Table 3.
>
> In A11 GPUs, pixel format conversion occurs on each load and store from tile memory to temporary registers in the shader core. Therefore, most pixel formats occupy the same size in tile memory as they do in system memory. However, there are still a few exceptions, as shown in Table 4.
>
> Note - These tables list only the color-renderable pixel formats that occupy different storage sizes in tile memory, including differences affected by the use of multisample antialiasing (MSAA). For a list of all color-renderable pixel formats, see Pixel Format Capabilities in [Metal Feature Set Tables](https://developer.apple.com/metal/Metal-Feature-Set-Tables.pdf).
>
> Table 2 A7 storage sizes, per pixel

从 A7 到 A10 GPU ，一些 color-renderable 像素格式当存储在 tile 存储器中时暂时扩展为浮点表示。因此，这些像素格式在 tile 存储器中占用的空间比在系统存储器中占用的空间更多，如表 2 和表 3 所示。

在 A11 GPU 中，像素格式转换发生在从 tile 内存到 shader core 临时寄存器的每次加载和存储操作上。因此，大多数像素格式在 tile 存储器中的占用与在系统存储器中的占用相同。但是，仍然有一些例外，如表 4 所示。

注意 - 这些表仅列出了在 tile 内存中占用不同存储大小的 color-renderable 像素格式，包括受多重采样抗锯齿（MSAA）影响的差异。有关所有 color-renderable 像素格式的列表，见 [Metal Feature Set Tables](https://developer.apple.com/metal/Metal-Feature-Set-Tables.pdf) 中的 Pixel Format Capabilities 。

表 2 A7 存储大小，每像素

Pixel format | Size in system memory (in bits) | Non-MSAA size in tile memory (in bits) | MSAA size in tile memory (in bits)
:------------ | :------------- | :------------- | :-------------
R8Unorm <br> R8Unorm_sRGB<br>R8Snorm<br>R8Uint<br>R8Sint | 8 | 32 | 32

> Knowing the storage sizes is particularly important if you're implementing rendering techniques that use multiple color render targets. For example, you might implement a deferred lighting algorithm that uses four color render targets with different pixel formats:

如果要实现使用多个颜色渲染目标的渲染技术，了解存储大小尤为重要。例如，可以实现延迟光照算法，该算法使用具有不同像素格式的四个颜色渲染目标：

```objc
MTLRenderPipelineDescriptor *gBufferDescriptor = [[MTLRenderPipelineDescriptor alloc] init];
gBufferDescriptor.colorAttachments[0].pixelFormat = MTLPixelFormatBGRA8Unorm;   // Albedo data and main drawable
gBufferDescriptor.colorAttachments[1].pixelFormat = MTLPixelFormatBGRA8Unorm;   // Surface normal data
gBufferDescriptor.colorAttachments[2].pixelFormat = MTLPixelFormatR16Float;     // Linear depth data
gBufferDescriptor.colorAttachments[3].pixelFormat = MTLPixelFormatR16Float;     // Light data
gBufferDescriptor.sampleCount = 4;
```

> In this render target configuration, the combined storage size in system memory is 96 bits per pixel (32+32+16+16). For comparison, the combined MSAA storage sizes in tile memory for the GPUs are:
>
> - A7 GPUs: 128 bits per pixel (32+32+32+32)
>
> - A8 through A10 GPUs: 192 bits per pixel (64+64+32+32)
>
> - A11 GPUs: 96 bits per pixel (32+32+16+16)

在此渲染目标配置中，系统内存中的组合存储大小为每像素 96 位（ 32 + 32 + 16 + 16 ）。为了进行比较，GPU 的 tile 存储器中的组合 MSAA 存储大小为：

- A7 GPU：每像素 128 位（ 32 + 32 + 32 + 32 ）

- A8 到 A10 GPU：每像素 192 位（ 64 + 64 + 32 + 32 ）

- A11 GPU：每像素 96 位（ 32 + 32 + 16 + 16 ）
